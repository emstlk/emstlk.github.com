<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Emaster blog : " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Emaster blog</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/emstlk">View on GitHub</a>

          <h1 id="project_title">Emaster blog</h1>
          <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>Настраиваем JRebel для удаленного приложения</h2>

<p>Столкнулся с проблемой, что <a href="http://zeroturnaround.com/software/jrebel/">JRebel</a> не работает с remote standalone application, т.е. без сервера приложений. Дальше были курения, как это работает и что можно сделать. Спасибо (<a href="https://github.com/shelajev" class="user-mention">@shelajev</a>), собственно он и предложил мне написать об этом.</p>

<p>Дальше будет пример, как я настроил JRebel в связке с <a href="https://www.dropbox.com/">Dropbox</a> под свое приложение.</p>

<h3>Настройка проекта</h3>

<p>Сначала необходимо добавить в ресурсы своего проекта конфиг <strong>rebel.xml</strong> с указанием пути, где необходимо брать новые классы. Мой выглядит вот так:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.zeroturnaround.com" xsi:schemaLocation="http://www.zeroturnaround.com http://www.zeroturnaround.com/alderaan/rebel-2_0.xsd"&gt;
    &lt;classpath&gt;
        &lt;dir name="/home/emaster/Dropbox/jrebel_sync/main"&gt;
        &lt;/dir&gt;
    &lt;/classpath&gt;
&lt;/application&gt;
</code></pre>

<p>Думаю <a href="https://www.dropbox.com/">Dropbox</a> на вашем компьютере уже установлен или вы можете это сделать без меня :)
Дальше нам нужно, чтобы Dropbox следил за файлами, получаемыми после компиляции проекта. Есть два варианта, либо изменить путь для скомпилированных классов в вашем проекте, либо сделать символьную ссылку. Мне второй вариант больше нравится, сейчас это можно в любой системе сделать (вариант для Linux, Mac):</p>

<pre><code>mkdir ~/Dropbox/jrebel_sync
cd ~/Dropbox/jrebel_sync
ln -s /home/emaster/dev/MyProject/target/classes/main
</code></pre>

<p>Таким образом в ~/Dropbox/jrebel_sync/main будут все скомпилированные классы.</p>

<h3>Настройка сервера</h3>

<p>Далее на сервер скачиваем <a href="http://zeroturnaround.com/software/jrebel/download/prev-releases/">свежий JRebel</a>, распаковываем куда-нибудь.
Добавляем параметры для запуска приложения:</p>

<pre><code>-javaagent:/home/emaster/jrebel/jrebel.jar
-Drebel.log=true
</code></pre>

<p>Теперь установим на сервере <a href="https://www.dropbox.com/install?os=lnx">Dropbox</a> и не забудьте его привязать к своему аккаунту. После установки в домашней директории появится Dropbox с правами только для текущего пользователя, нужно открыть доступ на чтение для всех. Выполним команду:</p>

<pre><code>chmod 755 /home/emaster/Dropbox
</code></pre>

<h3>Testing</h3>

<p>Осталось пересобрать наш проект и убедиться, что в логах при старте приложения есть строка:</p>

<pre><code>JRebel: Directory '/home/emaster/Dropbox/jrebel_sync/main' will be monitored for changes.
</code></pre>

<p>Если она присутствует, значит при любой компиляции файла Dropbox обновит его на сервера, а JRebel в свою очередь подхватит новый </p>

<h3>Возможные проблемы</h3>

<p>При новом билде приложения JRebel может подхватить (пока не разобрался почему) старые файлы из Dropbox. Как временный вариант можно чистить директорию target после каждого редеплоя.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-39670620-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
